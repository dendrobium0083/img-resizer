# テスト仕様書

**作成日**: 2025年12月2日  
**最終更新日**: 2025年12月2日  
**バージョン**: 1.1  
**対象プロジェクト**: img-resizer

## 実装状況サマリー ✅

**実装完了日**: 2025年12月2日  
**総テスト数**: 62テスト  
**テスト結果**: すべて成功（0失敗）

| レイヤー | テスト数 | ステータス |
|---------|---------|-----------|
| Domain層 | 4 | ✅ 完了 |
| Application層 | 28 | ✅ 完了 |
| Infrastructure層 | 21 | ✅ 完了 |
| Api層 | 9 | ✅ 完了 |
| **合計** | **62** | **✅ 完了** |

**使用ライブラリ**:
- xUnit: テストフレームワーク
- FluentAssertions: 読みやすいアサーション
- Moq: モックオブジェクトの作成
- Microsoft.AspNetCore.Mvc.Testing: 統合テスト用

---

## 目次

1. [テスト方針](#テスト方針)
2. [テストレベル](#テストレベル)
3. [テストプロジェクト構成](#テストプロジェクト構成)
4. [テストケース一覧](#テストケース一覧)
5. [テストデータ定義](#テストデータ定義)
6. [モック・スタブの使用方針](#モックスタブの使用方針)
7. [テストカバレッジ目標](#テストカバレッジ目標)
8. [テスト実行手順](#テスト実行手順)
9. [CI/CD統合](#cicd統合)

---

## テスト方針

### 基本方針

1. **テスト駆動開発（TDD）の原則に従う**
   - テストコードが「生きている仕様書」として機能する
   - テストコードを先に作成し、実装を検証する

2. **レイヤーごとの独立したテスト**
   - 各レイヤー（Domain、Application、Infrastructure、Api）で独立してテスト可能
   - レイヤー間の依存はモックで分離

3. **Resultパターンに基づくテスト**
   - 正常系と異常系を明示的にテスト
   - エラーコードとエラーメッセージを検証

4. **モダンなテストライブラリの活用**
   - xUnit: テストフレームワーク
   - FluentAssertions: 読みやすいアサーション
   - Moq: モックオブジェクトの作成

### テストの種類

- **単体テスト**: 各クラス・メソッドの動作を検証
- **統合テスト**: APIエンドポイントとファイルシステムの統合を検証
- **E2Eテスト**: 実際のファイルを使用したエンドツーエンドテスト（オプション）

---

## テストレベル

### レベル1: 単体テスト（Unit Tests）

各レイヤーの個別コンポーネントをテストします。

| レイヤー | 対象 | テストプロジェクト |
|---------|------|------------------|
| Domain | Resultクラス、エンティティ | `ImgResizer.Domain.Tests` |
| Application | CommandHandler、Validator、Behavior | `ImgResizer.Application.Tests` |
| Infrastructure | Repository、Service | `ImgResizer.Infrastructure.Tests` |

### レベル2: 統合テスト（Integration Tests）

APIエンドポイントとファイルシステムの統合をテストします。

| 対象 | テストプロジェクト |
|------|------------------|
| ImageController | `ImgResizer.Api.Tests` |
| ファイルシステム統合 | `ImgResizer.Api.Tests` |

### レベル3: E2Eテスト（End-to-End Tests）

実際の画像ファイルを使用した完全なフローのテスト（オプション）。

---

## テストプロジェクト構成

```
tests/
├── ImgResizer.Domain.Tests/          # Domain層の単体テスト
│   ├── Common/
│   │   └── ResultTests.cs ✅
│   └── Entities/
│       └── (今後追加)
│
├── ImgResizer.Application.Tests/     # Application層の単体テスト
│   ├── Commands/
│   │   └── ResizeImageCommandHandlerTests.cs ✅ 実装済み
│   ├── Validators/
│   │   └── ResizeImageCommandValidatorTests.cs ✅ 実装済み
│   └── Behaviors/
│       └── ValidationBehaviorTests.cs ✅ 実装済み
│
├── ImgResizer.Infrastructure.Tests/ # Infrastructure層の単体テスト
│   ├── Repositories/
│   │   └── FileSystemImageRepositoryTests.cs ✅ 実装済み
│   └── Services/
│       └── ImageResizeServiceTests.cs ✅ 実装済み
│
└── ImgResizer.Api.Tests/             # API統合テスト
    ├── WebApplicationFactory.cs ✅ 実装済み
    └── Controllers/
        └── ImageControllerTests.cs ✅ 実装済み
```

---

## テストケース一覧

### Domain層テスト

#### 1. Resultクラスのテスト ✅ **実装済み**

**ファイル**: `tests/ImgResizer.Domain.Tests/Common/ResultTests.cs`

| テストケース | 説明 | ステータス |
|------------|------|-----------|
| `Success_ShouldCreateSuccessResult` | 成功結果の作成を検証 | ✅ 実装済み |
| `Failure_ShouldCreateFailureResult` | 失敗結果の作成を検証 | ✅ 実装済み |
| `Success_WithValue_ShouldCreateSuccessResultWithValue` | 値付き成功結果の作成を検証 | ✅ 実装済み |
| `Failure_WithValue_ShouldCreateFailureResult` | 値付き失敗結果の作成を検証 | ✅ 実装済み |

**追加予定のテストケース**:
- `Success_WithErrorInfo_ShouldThrowException` - 成功時にエラー情報がある場合の例外
- `Failure_WithoutErrorCode_ShouldThrowException` - 失敗時にエラーコードがない場合の例外

---

### Application層テスト

#### 2. ResizeImageCommandHandlerのテスト ✅ **実装済み**

**ファイル**: `tests/ImgResizer.Application.Tests/Commands/ResizeImageCommandHandlerTests.cs`  
**実装日**: 2025年12月2日

**テストケース一覧**:

##### 正常系

| テストケース | 説明 | 期待結果 | ステータス |
|------------|------|---------|-----------|
| `Handle_ValidRequest_WithFitMode_ReturnsSuccess` | 有効なリクエスト（fitモード）で成功 | `Result<ResizeImageResponse>.IsSuccess = true` | ✅ 実装済み |
| `Handle_ValidRequest_WithCropMode_ReturnsSuccess` | 有効なリクエスト（cropモード）で成功 | `Result<ResizeImageResponse>.IsSuccess = true` | ✅ 実装済み |
| `Handle_ValidRequest_WithoutResizeMode_UsesDefaultFit` | ResizeMode未指定時、デフォルトでfitを使用 | `ResizeMode = "fit"` | ✅ 実装済み |
| `Handle_ValidRequest_GeneratesCorrectOutputPath` | 出力パスが正しく生成される | `OutputPath`が期待値と一致 | ✅ 実装済み |

##### 異常系

| テストケース | 説明 | 期待結果 | ステータス |
|------------|------|---------|-----------|
| `Handle_FileNotFound_ReturnsFailure` | ファイルが見つからない場合 | `ErrorCode = "FILE_NOT_FOUND"` | ✅ 実装済み |
| `Handle_ImageReadError_ReturnsFailure` | 画像読み込みエラー時 | `ErrorCode = "FILE_READ_ERROR"` | ✅ 実装済み |
| `Handle_ImageResizeError_ReturnsFailure` | 画像リサイズエラー時 | `ErrorCode = "IMAGE_PROCESSING_ERROR"` | ✅ 実装済み |
| `Handle_ImageSaveError_ReturnsFailure` | 画像保存エラー時 | `ErrorCode = "FILE_WRITE_ERROR"` | ✅ 実装済み |
| `Handle_CancellationToken_PropagatesCancellation` | CancellationTokenが伝播される | `OperationCanceledException` | ✅ 実装済み |

**モック対象**:
- `IImageRepository`
- `IImageResizeService`
- `IOptions<ImageResizeSettings>`
- `ILogger<ResizeImageCommandHandler>`

---

#### 3. ResizeImageCommandValidatorのテスト ✅ **実装済み**

**ファイル**: `tests/ImgResizer.Application.Tests/Validators/ResizeImageCommandValidatorTests.cs`  
**実装日**: 2025年12月2日

**テストケース一覧**:

##### 正常系

| テストケース | 説明 | 期待結果 | ステータス |
|------------|------|---------|-----------|
| `Validate_ValidCommand_ReturnsValid` | 有効なコマンドでバリデーション成功 | `IsValid = true` | ✅ 実装済み |
| `Validate_ValidCommand_WithFitMode_ReturnsValid` | fitモードでバリデーション成功 | `IsValid = true` | ✅ 実装済み |
| `Validate_ValidCommand_WithCropMode_ReturnsValid` | cropモードでバリデーション成功 | `IsValid = true` | ✅ 実装済み |
| `Validate_ValidCommand_WithoutResizeMode_ReturnsValid` | ResizeMode未指定でバリデーション成功 | `IsValid = true` | ✅ 実装済み |

##### 異常系

| テストケース | 説明 | 期待結果 | ステータス |
|------------|------|---------|-----------|
| `Validate_EmptyFilePath_ReturnsInvalid` | FilePathが空の場合 | `ErrorCode = "VALIDATION_ERROR"` | ✅ 実装済み |
| `Validate_FilePathWithPathTraversal_ReturnsInvalid` | パストラバーサル攻撃（`..`）を含む場合 | `ErrorCode = "VALIDATION_ERROR"` | ✅ 実装済み |
| `Validate_InvalidResizeMode_ReturnsInvalid` | 無効なResizeModeの場合 | `ErrorCode = "VALIDATION_ERROR"` | ✅ 実装済み |
| `Validate_FileNotFound_ReturnsInvalid` | ファイルが存在しない場合 | `ErrorCode = "FILE_NOT_FOUND"` | ✅ 実装済み |
| `Validate_UnsupportedFormat_ReturnsInvalid` | サポートされていない拡張子の場合 | `ErrorCode = "UNSUPPORTED_FORMAT"` | ✅ 実装済み |
| `Validate_FileTooLarge_ReturnsInvalid` | ファイルサイズが上限を超える場合 | `ErrorCode = "FILE_TOO_LARGE"` | ✅ 実装済み |

**テストデータ**:
- 有効なファイルパス: `"test.jpg"`, `"test.png"`, `"test.bmp"`
- 無効なファイルパス: `""`, `null`, `"../test.jpg"`, `"~/test.jpg"`
- 有効なResizeMode: `"fit"`, `"crop"`, `null`, `""`
- 無効なResizeMode: `"invalid"`, `"FIT"` (大文字)

---

#### 4. ValidationBehaviorのテスト ✅ **実装済み**

**ファイル**: `tests/ImgResizer.Application.Tests/Behaviors/ValidationBehaviorTests.cs`  
**実装日**: 2025年12月2日

**テストケース一覧**:

| テストケース | 説明 | 期待結果 | ステータス |
|------------|------|---------|-----------|
| `Handle_NoValidators_ExecutesNext` | バリデーターがない場合、次のハンドラーを実行 | ハンドラーが呼ばれる | ✅ 実装済み |
| `Handle_ValidRequest_ExecutesNext` | バリデーション成功時、次のハンドラーを実行 | ハンドラーが呼ばれる | ✅ 実装済み |
| `Handle_InvalidRequest_ReturnsFailure` | バリデーション失敗時、失敗結果を返す | `ErrorCode = "VALIDATION_ERROR"` | ✅ 実装済み |
| `Handle_MultipleValidators_AllPass_ExecutesNext` | 複数のバリデーターがすべて成功 | ハンドラーが呼ばれる | ✅ 実装済み |
| `Handle_MultipleValidators_OneFails_ReturnsFailure` | 複数のバリデーターの1つが失敗 | 最初のエラーを返す | ✅ 実装済み |
| `Handle_CancellationToken_PropagatesCancellation` | CancellationTokenが伝播される | `OperationCanceledException` | ✅ 実装済み |

**モック対象**:
- `IValidator<TRequest>`
- `RequestHandlerDelegate<TResponse>`

---

### Infrastructure層テスト

#### 5. FileSystemImageRepositoryのテスト ✅ **実装済み**

**ファイル**: `tests/ImgResizer.Infrastructure.Tests/Repositories/FileSystemImageRepositoryTests.cs`  
**実装日**: 2025年12月2日

**テストケース一覧**:

##### ReadImageAsync

| テストケース | 説明 | 期待結果 | ステータス |
|------------|------|---------|-----------|
| `ReadImageAsync_ExistingFile_ReturnsSuccess` | 存在するファイルを読み込む | `Result<byte[]>.IsSuccess = true` | ✅ 実装済み |
| `ReadImageAsync_NonExistentFile_ReturnsFailure` | 存在しないファイル | `ErrorCode = "FILE_NOT_FOUND"` | ✅ 実装済み |

##### SaveImageAsync

| テストケース | 説明 | 期待結果 | ステータス |
|------------|------|---------|-----------|
| `SaveImageAsync_ValidData_SavesFile` | 有効なデータを保存 | `Result.IsSuccess = true` | ✅ 実装済み |
| `SaveImageAsync_CreatesOutputDirectory` | 出力ディレクトリが存在しない場合、作成する | ディレクトリが作成される | ✅ 実装済み |

##### GetOutputPath

| テストケース | 説明 | 期待結果 | ステータス |
|------------|------|---------|-----------|
| `GetOutputPath_WithFitMode_GeneratesCorrectPath` | fitモードで正しいパスを生成 | パスが期待値と一致 | ✅ 実装済み |
| `GetOutputPath_WithCropMode_GeneratesCorrectPath` | cropモードで正しいパスを生成 | パスが期待値と一致 | ✅ 実装済み |

##### FileExists

| テストケース | 説明 | 期待結果 | ステータス |
|------------|------|---------|-----------|
| `FileExists_ExistingFile_ReturnsTrue` | 存在するファイルでtrueを返す | `true` | ✅ 実装済み |
| `FileExists_NonExistentFile_ReturnsFalse` | 存在しないファイルでfalseを返す | `false` | ✅ 実装済み |

**テストデータ**:
- テスト用画像ファイル（実際のファイルまたはメモリストリーム）
- 一時ディレクトリ（テスト後にクリーンアップ）

---

#### 6. ImageResizeServiceのテスト ✅ **実装済み**

**ファイル**: `tests/ImgResizer.Infrastructure.Tests/Services/ImageResizeServiceTests.cs`  
**実装日**: 2025年12月2日

**テストケース一覧**:

##### ResizeToSquareAsync

| テストケース | 説明 | 期待結果 | ステータス |
|------------|------|---------|-----------|
| `ResizeToSquareAsync_ValidImage_WithFitMode_ReturnsSuccess` | 有効な画像をfitモードでリサイズ | `Result<byte[]>.IsSuccess = true` | ✅ 実装済み |
| `ResizeToSquareAsync_ValidImage_WithCropMode_ReturnsSuccess` | 有効な画像をcropモードでリサイズ | `Result<byte[]>.IsSuccess = true` | ✅ 実装済み |
| `ResizeToSquareAsync_InvalidImageData_ReturnsFailure` | 無効な画像データ | `ErrorCode = "IMAGE_LOAD_ERROR"` | ✅ 実装済み |
| `ResizeToSquareAsync_OutputSize_Is512x512` | 出力サイズが512×512 | 出力画像のサイズが512×512 | ✅ 実装済み |
| `ResizeToSquareAsync_SquareImage_Returns512x512` | 正方形画像をリサイズ | 出力画像のサイズが512×512 | ✅ 実装済み |
| `ResizeToSquareAsync_PortraitImage_Returns512x512` | 縦長画像をリサイズ | 出力画像のサイズが512×512 | ✅ 実装済み |
| `ResizeToSquareAsync_LandscapeImage_Returns512x512` | 横長画像をリサイズ | 出力画像のサイズが512×512 | ✅ 実装済み |
| `IsSupportedFormat_SupportedFormats_ReturnsTrue` | サポートされている形式でtrueを返す | `true` | ✅ 実装済み |
| `IsSupportedFormat_UnsupportedFormat_ReturnsFalse` | サポートされていない形式でfalseを返す | `false` | ✅ 実装済み |

**テストデータ**:
- テスト用画像データ（JPEG、PNG、BMP）
- 異なるサイズの画像（横長、縦長、正方形）

---

### Api層テスト（統合テスト）

#### 7. ImageControllerのテスト ✅ **実装済み**

**ファイル**: `tests/ImgResizer.Api.Tests/Controllers/ImageControllerTests.cs`  
**実装日**: 2025年12月2日

**テストケース一覧**:

##### ResizeImage エンドポイント

| テストケース | 説明 | 期待結果 | ステータス |
|------------|------|---------|-----------|
| `ResizeImage_ValidRequest_Returns200Ok` | 有効なリクエストで200 OK | `StatusCode = 200` | ✅ 実装済み |
| `ResizeImage_FileNotFound_Returns404NotFound` | ファイルが見つからない場合 | `StatusCode = 404` | ✅ 実装済み |
| `ResizeImage_ValidationError_Returns400BadRequest` | バリデーションエラー | `StatusCode = 400` | ✅ 実装済み |
| `ResizeImage_UnsupportedFormat_Returns400BadRequest` | サポートされていない形式 | `StatusCode = 400` | ✅ 実装済み |
| `ResizeImage_FileTooLarge_Returns400BadRequest` | ファイルサイズ超過 | `StatusCode = 400` | ✅ 実装済み |
| `ResizeImage_WithCropMode_Returns200Ok` | cropモードで200 OK | `StatusCode = 200` | ✅ 実装済み |
| `ResizeImage_WithoutResizeMode_UsesDefaultFit` | ResizeMode未指定時、デフォルトfitを使用 | `ResizeMode = "fit"` | ✅ 実装済み |
| `ResizeImage_WithPngFormat_Returns200Ok` | PNG形式で200 OK | `StatusCode = 200` | ✅ 実装済み |
| `ResizeImage_InvalidResizeMode_Returns400BadRequest` | 無効なResizeModeで400 | `StatusCode = 400` | ✅ 実装済み |
| `ResizeImage_CancellationToken_PropagatesCancellation` | CancellationTokenが伝播される | `OperationCanceledException` |

**モック対象**:
- `IMediator`
- `ILogger<ImageController>`

**テスト方法**:
- `Microsoft.AspNetCore.Mvc.Testing`を使用した統合テスト
- 実際のHTTPリクエストをシミュレート

---

## テストデータ定義

### テスト用画像ファイル

| ファイル名 | 形式 | サイズ | 用途 |
|-----------|------|--------|------|
| `test-100x100.jpg` | JPEG | 100×100 | 小さい画像のテスト |
| `test-1920x1080.jpg` | JPEG | 1920×1080 | 横長画像のテスト |
| `test-1080x1920.jpg` | JPEG | 1080×1920 | 縦長画像のテスト |
| `test-512x512.png` | PNG | 512×512 | 正方形画像のテスト |
| `test-800x600.bmp` | BMP | 800×600 | BMP形式のテスト |
| `invalid-image.jpg` | 破損 | - | 無効な画像データのテスト |

### テスト用設定

```json
{
  "ImageResize": {
    "OutputDirectory": "test-output",
    "TargetSize": {
      "Width": 512,
      "Height": 512
    },
    "AllowedExtensions": [".jpg", ".jpeg", ".png", ".bmp"],
    "MaxFileSize": 10485760,
    "ResizeModes": ["fit", "crop"]
  }
}
```

### テスト用ディレクトリ構造

```
test-data/
├── input/              # 入力画像ファイル
│   ├── test-100x100.jpg
│   ├── test-1920x1080.jpg
│   └── ...
└── output/             # 出力先（テスト後にクリーンアップ）
```

---

## モック・スタブの使用方針

### モックを使用する場合

1. **Application層のテスト**
   - `IImageRepository` - ファイルシステムへの依存を排除
   - `IImageResizeService` - 画像処理ライブラリへの依存を排除
   - `IOptions<ImageResizeSettings>` - 設定値の制御
   - `ILogger<T>` - ログ出力の検証（必要に応じて）

2. **Api層のテスト**
   - `IMediator` - MediatRの動作を制御
   - `ILogger<T>` - ログ出力の検証（必要に応じて）

### スタブを使用する場合

1. **Infrastructure層のテスト**
   - 実際のファイルシステムを使用（一時ディレクトリ）
   - テスト後にクリーンアップ

2. **統合テスト**
   - 実際のファイルシステムを使用
   - テスト用の画像ファイルを使用

### モックの作成例

```csharp
// IImageRepositoryのモック
var mockRepository = new Mock<IImageRepository>();
mockRepository
    .Setup(r => r.ReadImageAsync(It.IsAny<string>()))
    .ReturnsAsync(Result.Success<byte[]>(testImageData));

// IImageResizeServiceのモック
var mockService = new Mock<IImageResizeService>();
mockService
    .Setup(s => s.ResizeToSquareAsync(
        It.IsAny<byte[]>(),
        It.IsAny<int>(),
        It.IsAny<string>(),
        It.IsAny<string>()))
    .ReturnsAsync(Result.Success<byte[]>(resizedImageData));
```

---

## テストカバレッジ目標

### カバレッジ目標

| レイヤー | 目標カバレッジ | 優先度 |
|---------|---------------|--------|
| Domain層 | 100% | 最高 |
| Application層 | 90%以上 | 高 |
| Infrastructure層 | 80%以上 | 中 |
| Api層 | 80%以上 | 中 |

### カバレッジ測定

- **ツール**: coverlet.collector（既に追加済み）
- **レポート形式**: OpenCover、Cobertura
- **CI/CD統合**: カバレッジレポートを自動生成

### カバレッジ測定コマンド

```bash
# カバレッジ測定
dotnet test /p:CollectCoverage=true /p:CoverletOutputFormat=opencover

# レポート生成（ReportGeneratorを使用）
reportgenerator -reports:coverage.opencover.xml -targetdir:coverage-report
```

---

## テスト実行手順

### ローカル環境での実行

#### 1. すべてのテストを実行

```bash
# ソリューション全体のテストを実行
dotnet test src/img-resizer.sln

# 特定のテストプロジェクトを実行
dotnet test tests/ImgResizer.Domain.Tests/ImgResizer.Domain.Tests.csproj

# 詳細な出力で実行
dotnet test --verbosity normal

# カバレッジ付きで実行
dotnet test /p:CollectCoverage=true
```

#### 2. 特定のテストクラスを実行

```bash
# フィルターを使用
dotnet test --filter "FullyQualifiedName~ResultTests"
```

#### 3. 特定のテストメソッドを実行

```bash
# フィルターを使用
dotnet test --filter "FullyQualifiedName~Success_ShouldCreateSuccessResult"
```

### Visual Studio / Rider での実行

1. テストエクスプローラーを開く
2. 実行したいテストを選択
3. 「実行」または「デバッグ」をクリック

### テストの命名規則

- **テストクラス**: `{対象クラス名}Tests`
- **テストメソッド**: `{メソッド名}_{条件}_{期待結果}`

例:
- `ResizeImageCommandHandlerTests`
- `Handle_ValidRequest_WithFitMode_ReturnsSuccess`

---

## CI/CD統合

### GitHub Actions での実行例

```yaml
name: Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x
    
    - name: Restore dependencies
      run: dotnet restore
    
    - name: Build
      run: dotnet build --no-restore
    
    - name: Test
      run: dotnet test --no-build --verbosity normal /p:CollectCoverage=true
    
    - name: Upload coverage reports
      uses: codecov/codecov-action@v3
      with:
        files: ./coverage.opencover.xml
```

### テスト結果の確認

- **ローカル**: テストエクスプローラー、ターミナル出力
- **CI/CD**: GitHub Actionsのログ、Codecovレポート

---

## テスト実装の優先順位

### フェーズ1: 基盤テスト（最優先）✅ **完了**

- ✅ Domain層: `Result`クラスのテスト
- ✅ テストプロジェクトの基盤構築

### フェーズ2: コアロジックのテスト（完了） ✅

1. **Application層**
   - ✅ `ResizeImageCommandHandler`のテスト（実装日: 2025-12-02）
   - ✅ `ValidationBehavior`のテスト（実装日: 2025-12-02）
   - ✅ `ResizeImageCommandValidator`のテスト（実装日: 2025-12-02）

2. **Domain層**
   - `Result`クラスの追加テスト（エッジケース）- 今後追加予定

### フェーズ3: Infrastructure層のテスト（完了） ✅

1. ✅ `FileSystemImageRepository`のテスト（実装日: 2025-12-02）
2. ✅ `ImageResizeService`のテスト（実装日: 2025-12-02）

### フェーズ4: 統合テスト（完了） ✅

1. ✅ `ImageController`の統合テスト（実装日: 2025-12-02）
2. E2Eテスト（オプション）- 今後追加予定

### 実装状況サマリー

**実装完了日**: 2025年12月2日  
**総テスト数**: 62テスト  
**テスト結果**: すべて成功（0失敗）

| レイヤー | テスト数 | ステータス |
|---------|---------|-----------|
| Domain層 | 4 | ✅ 完了 |
| Application層 | 28 | ✅ 完了 |
| Infrastructure層 | 21 | ✅ 完了 |
| Api層 | 9 | ✅ 完了 |
| **合計** | **62** | **✅ 完了** |

---

## テストメンテナンス

### テストコードの更新タイミング

1. **機能追加時**: 新しい機能に対応するテストを追加
2. **バグ修正時**: バグを再現するテストを追加し、修正を検証
3. **リファクタリング時**: テストが壊れていないことを確認

### テストコードの品質基準

- **AAAパターン**: Arrange（準備）、Act（実行）、Assert（検証）
- **1つのテストメソッドで1つのことをテスト**
- **テスト名は意図が明確**
- **モックは必要最小限に**
- **テストデータは明確に定義**

---

## 参考資料

- [xUnit Documentation](https://xunit.net/)
- [FluentAssertions Documentation](https://fluentassertions.com/)
- [Moq Documentation](https://github.com/moq/moq4)
- [.NET Testing Best Practices](https://docs.microsoft.com/en-us/dotnet/core/testing/)

---

**文書管理情報**
- 最終更新日: 2025年12月2日
- 作成者: テックリード
- レビュー状況: 初版作成
- 次回レビュー予定: フェーズ2テスト実装完了後

