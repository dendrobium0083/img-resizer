# Cursor Rules for img-resizer Project

## プロジェクト概要
このプロジェクトは、画像を512×512の正方形に変換するASP.NET Core WebAPIアプリケーションです。
クリーンアーキテクチャの原則に基づいて設計されています。

## 技術スタック
- **言語**: C# (.NET 8.0)
- **フレームワーク**: ASP.NET Core WebAPI
- **アーキテクチャ**: クリーンアーキテクチャ
- **画像処理**: System.Drawing.Common

## 開発方針

### アーキテクチャ原則
- クリーンアーキテクチャの原則に厳密に従う
- レイヤー間の依存関係を明確に保つ
  - Domain層: 他のレイヤーに依存しない
  - Application層: Domain層のみに依存
  - Infrastructure層: Domain層に依存
  - Presentation層: Application層とInfrastructure層に依存
- インターフェースによる依存関係の逆転を徹底する

### コーディング規約
- C# のコーディング規約に従う
- 非同期処理は `async/await` を使用
- リソース管理は `using` ステートメントを適切に使用
- null許容参照型を有効に活用
- 例外処理は適切な例外型を使用し、エラーコードを定義

### 命名規則
- クラス名: PascalCase
- メソッド名: PascalCase
- 変数名: camelCase
- インターフェース: `I` プレフィックス（例: `IImageRepository`）
- エンティティ: ドメイン名を含む（例: `ImageFile`）
- DTO: 用途を明確に（例: `ResizeImageRequest`）

### ファイル構造
```
img-resizer/
├── src/
│   ├── ImgResizer.Api/              # Presentation層
│   ├── ImgResizer.Application/       # Application層
│   ├── ImgResizer.Domain/            # Domain層
│   └── ImgResizer.Infrastructure/    # Infrastructure層
├── tests/                            # テストプロジェクト
└── docs/                             # ドキュメント
```

## ドキュメント作成ルール

### 言語
- **すべてのドキュメントは日本語で作成する**
- コードコメントも日本語で記述する

### ドキュメント構成
- 要件定義書: `docs/要件定義書.md` ✅ 作成済み
- 機能仕様書: `docs/機能仕様書.md` ✅ 作成済み
- API仕様書: `docs/API仕様書.md` ✅ 作成済み
- データ仕様書: `docs/データ仕様書.md` ✅ 作成済み
- 基本設計書: `docs/基本設計書.md` ✅ 作成済み
- 詳細設計書: `docs/詳細設計書.md` ✅ 作成済み
- エラーハンドリング仕様書: `docs/エラーハンドリング仕様書.md` ✅ 作成済み
- ドキュメント一覧: `docs/ドキュメント一覧.md` ✅ 作成済み
- 開発ガイド: `docs/クイックスタートガイド.md`, `docs/Gitセットアップガイド.md` など

### スペック開発
- 開発前に詳細な仕様書を作成する
- 仕様書に基づいて実装する
- 仕様変更時は必ず仕様書を更新する

## コード生成時の注意事項

### 必須事項
1. 既存のアーキテクチャパターンに従う
2. レイヤー分離を厳守する
3. インターフェースを定義してから実装する
4. 適切なエラーハンドリングを実装する
5. ロギングを適切に実装する

### 禁止事項
1. レイヤー間の直接的な依存関係を作らない
2. ビジネスロジックをPresentation層に書かない
3. 外部ライブラリへの直接依存をDomain層に作らない
4. ハードコードされた値を使用しない（設定ファイルから読み込む）

### 画像処理の実装
- アスペクト比を維持したリサイズ
- 高品質なリサンプリングアルゴリズムを使用
- メモリリークを防ぐため、`using` ステートメントでリソースを適切に解放
- 非同期I/O操作を使用

### セキュリティ
- パストラバーサル攻撃を防止
- ファイルサイズ制限を実装
- 拡張子のホワイトリスト検証
- 入力値のバリデーションを徹底

## テスト
- 単体テストを各レイヤーで実装
- モックを使用してレイヤー間の依存を分離
- 統合テストでAPIエンドポイントを検証
- テストカバレッジを維持

## エラーハンドリング
- カスタム例外クラスを使用（エラーハンドリング仕様書参照）
- エラーコードを定義（エラーハンドリング仕様書参照）
- 適切なHTTPステータスコードを返却
- エラーログを記録
- 詳細は `docs/エラーハンドリング仕様書.md` を参照

## API設計
- RESTful APIの原則に従う
- JSON形式のリクエスト/レスポンス
- 適切なHTTPステータスコード
- Swagger/OpenAPIドキュメントを提供

## 設定管理
- `appsettings.json` から設定を読み込む
- 環境ごとの設定ファイルに対応
- 設定値のバリデーションを実装

## コミットメッセージ
- 日本語で記述
- 変更内容を明確に記述
- 関連する要件IDやチケット番号を記載

## コードレビュー
- アーキテクチャ原則の遵守を確認
- セキュリティ要件の遵守を確認
- テストの実装を確認
- ドキュメントの更新を確認

